#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <string.h>
#include <assert.h>


#include "global-p.h"
#include "struct.h"


unsigned int H[11]={
0b10000000000111110010010,
0b01000000000011111001001,
0b00100000000110001110110,
0b00010000000011000111011,
0b00001000000110010001111,
0b00000100000100111010101,
0b00000010000101101111000,
0b00000001000010110111100,
0b00000000100001011011110,
0b00000000010000101101111,
0b00000000001111100100101
};

unsigned syndrome[2048]={0,4096,8192,12288,16384,20480,24576,28672,32768,36864,40960,45056,49152,53248,57344,2098178,65536,69632,73728,77824,81920,86016,90112,262528,98304,102400,106496,1572896,114688,131081,4196356,592,131072,135168,139264,143360,147456,151552,155648,4194352,163840,167936,172032,2240,180224,65545,525056,1310724,196608,200704,204800,1540,212992,32777,3145792,526338,229376,16393,262162,6291712,4105,9,1184,8201,262144,266240,270336,274432,278528,282624,286720,65920,294912,299008,303104,4194824,311296,526352,97,1179652,327680,331776,335872,16768,344064,8576,4480,384,360448,2097220,131090,3073,1050112,4194338,2621448,33152,393216,397312,401408,2621441,409600,578,3080,1081348,425984,1312,65554,1064964,6291584,1056772,1052676,1048580,458752,5244928,32786,104,524324,2098192,4194817,131456,8210,524928,18,4114,2368,262153,16402,1114116,524288,528384,532480,536576,540672,544768,548864,76,557056,561152,565248,1114144,573440,264208,131840,4194433,589824,593920,598016,1081376,606208,6291968,1041,133122,622592,1056800,1052704,1048608,194,1284,2359304,1064992,655360,659456,663552,2359297,671744,1049728,33536,67586,688128,4194310,17152,1048,8960,2097248,768,4864,720896,336,4194440,18434,262180,10242,6146,2050,2100224,262784,69,1179680,5242896,524297,66304,34818,786432,790528,794624,2228225,802816,34832,5242882,1568,819200,18448,1156,322,6160,2064,2162696,10256,851968,1034,2624,4194324,131108,1048641,2129928,524672,4194561,131712,2113544,1310752,2105352,67600,2097160,2101256,917504,2105345,2101249,2097153,65572,4194568,208,2113537,1048648,66176,4196384,2129921,1027,133136,262912,1572868,16420,33408,1049856,2162689,36,4132,8228,264194,4736,640,524306,8832,32804,17024,2228232,4195392,1048576,1052672,1056768,1060864,1064960,1069056,1073152,2561,1081344,1085440,1089536,589856,1097728,4194624,152,393220,1114112,1118208,1122304,557088,1130496,22,2228288,4195336,1146880,532512,528416,524320,263680,2099328,259,540704,1179648,1183744,1187840,266,1196032,525440,2162752,294916,1212416,2097680,4195329,278532,2082,270340,266244,262148,1245184,4458496,2113600,145,2105408,800,2097216,2101312,388,1090,2568,655392,4718608,1048585,2129984,327684,1310720,1314816,1318912,1104,1327104,2097192,4718594,163844,1343488,131,2099456,147460,67072,139268,135172,131076,1376256,4327424,13,2097666,34304,524353,2096,1048960,17920,280,4194496,786464,1536,5632,9728,196612,1441792,4261888,672,49156,273,40964,36868,32772,524360,24580,20484,16388,12292,8196,4100,4,4200448,4196352,525568,4204544,138,4212736,2359360,98308,2097185,4229120,1048594,81924,132608,73732,69636,65540,1572864,1576960,1581056,98336,1589248,132224,4456450,2097424,1605632,73760,69664,65568,2097157,522,3136,81952,1638400,40992,36896,32800,2312,262209,644,49184,12320,8224,4128,32,4325392,24608,20512,16416,1703936,17536,2068,4194880,5248,1152,41,9344,262216,2305,2097282,196640,4259856,33920,1049344,786436,515,2097164,263424,163872,4227088,66688,2621504,1050626,4210704,139296,135200,131104,4194320,4198416,4202512,147488,1835008,772,4210690,2184,4202498,65601,4194306,4198402,131144,6292480,529,327712,416,1050640,4227074,655364,2097296,16449,132352,294944,4161,65,4259842,8257,2054,270368,266272,262176,525824,32833,3145736,278560,32840,50,66816,3145729,2099712,263296,4325378,557060,72,4168,8264,540676,16456,532484,528388,524292,9472,4720640,1280,5376,1048612,131137,17664,536,65608,1049216,34048,393248,4456464,2097410,2177,589828,2097152,2101248,2105344,2109440,2113536,2117632,2121728,33794,2129920,2134016,2138112,17410,2146304,9218,5122,1026,2162688,2166784,2170880,2072,2179072,4719104,1179712,37,2195456,262212,641,4325632,304,1050752,786440,66562,2228224,2232320,2236416,786433,2244608,2308,1114176,648,2260992,1049104,44,4260096,4456576,524384,2065,132098,2293760,162,1065024,4227328,1056832,263184,1048640,1052736,527360,4202752,4198656,4194560,518,2097161,1081408,4210944,2359296,2363392,2367488,655361,2375680,1048616,532,4196416,2392064,65604,1050880,176,4325504,769,589832,263170,2424832,32836,4195360,1049090,2051,132112,557064,2097536,4164,68,540680,8260,532488,16452,524296,528392,2490368,532481,528385,524289,4227200,66576,290,540673,4210816,2058,1600,557057,4194432,4198528,4202624,3145732,776,17424,2180,589825,5136,1040,1310784,9232,1048609,131140,2097170,4456704,4259968,33808,655368,2592,2621440,2625536,2629632,393217,2637824,4260352,2208,1048848,2654208,392,4194384,2564,1048581,131168,327688,525314,2686976,4211200,262,1216,4198912,4194816,294920,4203008,134144,19,278536,3145760,270344,4227584,262152,266248,2752512,270337,266241,262145,26,32864,4195332,278529,68608,16480,1048706,294913,4192,96,2097920,8288,35840,1048588,560,327681,385,4325888,1572928,2099202,3072,7168,11264,4718848,19456,65632,393224,148,2883584,139265,135169,131073,1344,134,98312,147457,546,5243904,81928,163841,73736,2099216,65544,69640,1048720,2336,49160,196609,40968,4456960,32776,36872,24584,524356,16392,20488,8200,12296,8,4104,12289,8193,4097,1,1051136,24577,20481,16385,276,40961,36865,32769,4718720,262240,196616,49153,4194370,73729,69633,65537,2097188,525328,163848,81921,265216,2097792,147464,98305,139272,1048834,131080,135176,3145728,3149824,3153920,4194436,3162112,262184,196672,524560,3178496,131600,264448,73,524293,67712,4194848,1049602,3211264,1281,147520,262658,139328,34944,131136,135232,4194314,18560,1044,2621472,6272,2176,163904,10368,3276800,33296,81984,3104,73792,4194307,65600,69696,4624,528,524418,8720,1288,16912,98368,2359300,24640,524300,16448,20544,8256,12352,64,4160,262177,66064,49216,5243136,41024,133248,32832,36928,3407872,16424,35072,66050,4136,40,1153,8232,10496,4719616,2304,6400,82,32808,18688,2228228,524432,8706,4610,514,4194564,65576,393280,16898,131105,1048644,67840,33282,2098688,264320,1572872,4194321,1030,448,4194328,1572865,526848,131112,327744,2129924,65569,262672,133376,2113540,5243008,2105348,2101252,2097156,32801,6293504,278592,131586,270400,1049616,262208,266304,33,4129,8225,1160,16417,524546,294976,2162692,3670016,2114,1544,16656,32773,8464,4368,272,16389,4457472,131202,2162720,5,4101,8197,33040,262288,131084,4196353,2129952,1058,5243392,655424,65808,832,2105376,2101280,2097184,65541,526464,1310728,2113568,4194592,65548,32898,1310721,264704,2098304,589888,131344,8322,524816,130,4226,131077,1048672,16514,4196360,4108,12,540736,8204,532544,16396,524352,528448,1051648,32780,65666,2228256,6291472,262402,557120,1537,65680,4228096,100,1179649,133632,524328,6291458,262416,4199424,4195328,526592,4203520,262149,4211712,1114120,704,144,4240,8336,524802,16528,2097217,1081352,3076,32912,4260864,1064968,2359328,1056776,131330,1048584,1052680,18944,1056769,1052673,1048577,2560,6656,10752,1064961,2097224,4326400,262274,1081345,35328,65794,1072,2621444,131216,262156,2098432,1114113,68096,33026,786496,4194464,524321,16642,4194820,2128,4354,258,1179656,8450,4194304,4198400,4202496,4206592,4210688,4214784,4218880,131120,4227072,4231168,4235264,262664,4243456,1048896,67588,524417,4259840,4263936,4268032,67,4276224,2621952,34820,1049608,4292608,1168,18436,2228480,10244,262178,2052,6148,4325376,4329472,4333568,16432,4341760,8240,4144,48,4358144,524294,1049601,2162944,2359424,3584,74,32816,4390912,1312768,524424,2130176,1282,196,262657,65584,608,2105600,2101504,2097408,1572880,4194313,133124,2113792,4456448,4460544,4464640,33288,4472832,1029,1572866,2099264,4489216,8712,4616,520,2228352,65570,1296,16904,4521984,1181696,2098208,524308,88,32802,131585,4194688,524545,16418,1048768,66056,4130,34,264196,8226,4587520,1116160,324,1154,2130048,524552,66049,262192,2113664,81,526368,131592,2097280,2101376,2105472,5242884,1054720,1050624,16897,1058816,8705,1067008,513,4609,1036,1083392,4194322,2359552,2162816,131106,33281,525376,4718592,4722688,4726784,3328,4734976,2163200,1310722,32897,4751360,131078,2097232,16513,1064,8321,4225,129,4784128,2114048,131208,262164,2101760,2097664,352,2105856,262401,2120,1538,5242912,1179664,2130432,526340,65665,4849664,32774,65672,1049152,2113,262408,2098180,524336,4102,6,264224,8198,1114128,16390,4195072,131201,8328,1057,136,4232,1081360,2228736,16520,4196354,1064976,65542,32904,2621696,1048592,1052688,1056784,263232,4980736,224,1064962,65556,1056770,131336,1048578,1052674,65793,3146752,133152,524808,580,4196368,1081346,262273,33025,8212,4116,20,3200,2359808,1114114,16404,257,4353,8449,32788,16641,524322,6291464,132160,1552,16648,34848,6291457,4360,264,1179650,8456,10272,262150,2080,6176,2621568,33032,18464,66624,2097218,1574912,262280,131092,4194340,65800,524801,33856,131329,4194944,67616,17472,1310736,9280,5184,1088,5242880,5246976,5251072,2097284,5259264,33088,786434,66568,5275648,16704,132097,2066,4416,320,2097696,8512,5308416,395264,784,17416,161,9224,5128,1032,2097162,517,262336,4718624,655376,65856,1050628,33800,5373952,329728,33793,524864,524,2097155,2432,1048624,9217,168,1025,5121,589840,131392,17409,4456452,268288,264192,38,272384,557072,280576,6291520,132104,540688,296960,66561,3145984,524304,528400,532496,642,5505024,198656,540674,289,532482,656,524290,528386,52,2622464,65728,1049096,2057,262464,557058,4325380,137216,133120,32960,141312,2097412,149504,589826,263176,8384,165888,192,4288,4195840,1048610,16576,2097169,71680,67584,2097176,75776,1120,83968,655362,4227076,770,100352,263169,4210692,3145856,4202500,4198404,4194308,6144,2048,14336,10240,22528,18432,1049089,26624,38912,34816,131264,43008,786448,51200,296,4259844,5767168,25,278530,131648,270338,2084,262146,266242,2688,2360320,268,4259872,196624,524608,294914,1048705,1092,386,2099201,4227104,163856,3146240,327682,525320,147472,4202528,4198432,4194336,131088,135184,139280,4210720,2097440,8768,4672,576,98320,4195456,393218,16960,81936,1048582,525313,33344,65552,69648,73744,2099208,49168,788480,1048712,66112,32784,36880,40976,261,16400,20496,24592,4325408,16,4112,8208,12304,24578,2130944,16386,20482,8194,12290,2,4098,2102272,2098176,49154,2106368,40962,2114560,32770,36866,552,657408,81922,1048596,73730,4194369,65538,69634,1048833,2163712,524480,4456480,393232,140,98306,2816,133,591872,147458,262720,139266,1048840,131074,135170,4194376,2229248,1050656,400,327696,545,163842,4718596,530432,526336,4195584,534528,294928,542720,196610,2097312,278544,559104,2097668,11,262160,266256,270352,1049664,6291456,6295552,6299648,1048708,6307840,590336,265,264256,6324224,2081,524368,196864,393344,28,1049120,4195330,6356992,541184,263200,164096,528896,524800,146,532992,1048586,139520,135424,131328,1089,557568,2099204,147712,6422528,1096,2562,98560,295040,1048579,525316,2097200,278656,73984,69888,65792,262272,266368,270464,82176,21,41216,37120,33024,2088,655872,5242944,49408,12544,8448,4352,256,327808,24832,20736,16640,6553600,274,66592,18496,163968,10304,6208,2112,147584,1573888,7,2097672,131200,135296,139392,34880,9248,137,1056,5152,1048836,786944,17440,67648,2576,4194372,33824,393472,196736,2097186,4718600,1048593,49280,548,1048600,4718593,32896,36992,41088,133184,16512,20608,24704,327936,128,4224,8320,12416,524354,3147776,132128,295168,98432,4195344,2097665,14,82048,270592,266496,262400,65664,69760,73856,278784,6815744,82432,32848,42,70144,66048,132100,74240,8272,1311744,80,4176,2306,98816,16464,2097281,20992,16896,1050625,25088,4608,512,12800,8704,164,49664,65616,655616,37376,33280,4456456,41472,1048864,2192,17412,4456449,9220,197120,1028,5124,521,2097158,131152,590080,786560,4194400,33796,1050632,262210,147968,2097288,557312,135680,131584,66564,139776,4197376,532736,528640,524544,3145744,164352,35,540928,2060,1082368,896,4325377,49,328192,3145730,526400,1053696,1049600,262224,1057792,655488,1065984,4259848,292,131138,279040,525344,2097172,266752,262656,4227080,270848,2097409,1115136,4210696,2178,4202504,295424,4194312,4198408,65602,4202497,4198401,4194305,557184,2097416,263172,4210689,540800,1180672,2099232,4227073,524416,528512,532608,530,66,4162,8258,4259841,16450,393728,2320,1048736,32834,56,1049092,786688,589952,2053,4325384,2098240,7340032,8324,4228,132,3088,131075,33312,16516,65546,787456,16928,32900,8736,2097472,544,4640,32778,112,526337,65668,262404,1573376,4325440,2098184,10,4106,8202,1179904,16394,4196480,66080,262161,524576,16387,262168,131204,4099,3,4259904,8195,2116,4194832,2098177,1114368,1310848,32771,131616,526344,1664,2361344,4210752,1081600,4202560,65539,4194368,4198464,131082,1057024,1052928,1048832,2621456,1060,4227136,1065216,577,558080,131096,262276,65796,4194344,2621442,1050688,529408,525312,4196608,533504,1179776,541696,262688,65553,16644,2230272,1049632,4194818,260,4356,8452,32785,262154,590848,2097344,16401,33028,8209,4113,17,8216,2164736,24,4120,1081472,262147,16408,1792,1065088,656384,32792,98,1048704,1052800,1056896,6291460,2103296,2099200,65560,2107392,131332,2115584,4456512,524448,4194337,2131968,524804,1310976,1114240,584,3074,131089,131360,295936,67585,524420,200,1114624,2359298,4194576,267264,263168,1048656,271360,4194309,279552,524832,133128,10241,1065472,2049,6145,1053184,1049088,18433,1057280,524298,328704,34817,6291488,2228240,1081856,1408,70,288,4384,8480,2097728,16672,524291,1049604,34824,33056,394240,4194434,18440,2162704,10248,6152,2056,65824,4194316,133121,1042,2129936,1180160,4718656,262304,2113552,193,262660,1573120,2097168,2101264,2105360,67592,37888,33792,2113538,41984,2105346,50176,2097154,2101250,5120,1024,13312,9216,21504,17408,2129922,25600,4194448,99328,264193,328,524548,1311232,2162690,131232,70656,66560,131588,74752,2144,82944,5242888,524305,262432,164864,524312,5242881,4196864,84,2228226,65696,136192,132096,66052,140288,1572992,148480,321,264200,1048642,2623488,33284,16544,1033,8352,4256,160,8708,197632,516,4612,2359312,4194562,16900,32928};


unsigned int enc(unsigned int y, unsigned int z)
{
  unsigned long long  c;
  
  c=0;
  while(y!=0){
    if(y&1) c ^=z;
    z<<=1; y>>=1;
  }
  return c;
  
}


// 多項式の次数(default)
int deg(vec a)
{
    int i, n = 0, flg = 0;

    // #pragma omp parallel for
    for (i = 0; i < DEG; i++)
    {
        if (a.x[i] != 0)
        {
            n = i;
            flg = 1;
        }
    }
    if (flg == 0)
        return 0;

    return n;
}


vec vmul(vec a, vec b,int R)
{
    int i, j, k, l;
    vec c = {0};

    k = deg(a);
    l = deg(b);

    if(l+k>N){
        printf("blake %d\n",l+k);
        exit(1);
    }
    i = 0;
    while (i < k + 1)
    {
        for (j = 0; j < l + 1; j++)
        {
            if (a.x[i] > 0)
                c.x[i + j] = (c.x[i + j] + a.x[i] * b.x[j]) % R;
        }
        i++;
    }

    return c;
}


//整数からベクトル型への変換
vec i2v(unsigned long long n)
{
    vec v = {0};
    int i = 0;

    while (n > 0)
    {
        v.x[i++] = n % 2;
        n = (n >> 1);
    }

    return v;
}

//ベクトル型から整数への変換
unsigned long long v2i(vec v)
{
    unsigned long long int d = 0, i;

    for (i = 0; i < 64; i++)
    {
        d ^= (v.x[i] << i);
    }
    
    return d;
}


// リーディグタームを抽出(default)
oterm vLT(vec f)
{
    int i;
    oterm t = {0};

    // k = deg (o2v (f));
    for (i = 0; i < DEG; i++)
    {
        // printf("a=%d %d\n",f.t[i].a,f.t[i].n);
        if (f.x[i] > 0)
        {
            t.n = i;
            t.a = f.x[i];
        }
    }

    return t;
}



unsigned long long  gcd(unsigned long long  a, unsigned long long  b)
{
  int r, tmp;

  if(b==0 || a==0)
  return 0;
  /* 自然数 a > b を確認・入替 */
  if (a < b)
  {
    tmp = a;
    a = b;
    b = tmp;
  }

    //b=N;
  /* ユークリッドの互除法 */
  r = (a % b);
  while (r != 0)
  {
    a = b;
    b = r;
    r = (a % b);
  }

  /* 最大公約数を出力 */
  //printf("最大公約数 = %d\n", b);
  if(b!=1)
  {
    printf("(a,b)!=1\n");
    return -1;
  }

  return b;
}



// 整数の逆数
unsigned long long  inv(unsigned long long  a, unsigned long long  n)
{

    if(gcd(a,n)!=1){
        printf("(a,n)!=1\n");
        return -1;
    }
    unsigned long long  d = n;
    unsigned long long  x = 0;
    unsigned long long  s = 1;
    while (a != 0)
    {
        unsigned long long  q = d / a;
        unsigned long long  r = d % a;
        d = a;
        a = r;
        unsigned long long  t = x - q * s;
        x = s;
        s = t;
    }
    unsigned long long  gcd = d; // $\gcd(a, n)$

    return ((x + n) % (n / d));
}

// aに何をかけたらbになるか
 unsigned long long 
equ( unsigned long long  a,  unsigned long long  b)
{
    // for(unsigned long long  i=0;i<N;i++)
    if (b == 0)
        return 0;
    if (a == 1)
        return b;
    if(a==b)
    return 1;

    return (inv(a, N) * b) % N;
}

//モニック多項式にする
vec coeff(vec f,  unsigned long long  d)
{
  int i, j, k;
  vec a, b;

  k = deg((f)) + 1;
  for (i = 0; i < k; i++)
    f.x[i] = (f.x[i]*inv(d,N))%N;

  return f;
}


// 多項式を単行式で割る
oterm vLTdiv(vec f, oterm t)
{
    oterm tt = {0}, s = {
                        0};

    tt = vLT(f);
    if (tt.n < t.n)
    {
        s.n = 0;
        s.a = 0;
    }
    else if (tt.n == t.n)
    {
        s.n = 0;
        s.a = equ(t.a, tt.a);
    }
    else if (tt.n > t.n)
    {
        s.n = tt.n - t.n;
        s.a = equ(t.a, tt.a);
        // printf("%u\n",s.a);
    }
    else if (t.n == 0 && t.a > 0)
    {
        s.a = (tt.a * inv(t.a, N)) % N;
        s.n = tt.n;
    }

    return s;
}

vec vadd(vec a, vec b)
{
    int i;
    vec c = {0};

    // printf("deg=%d %d\n",deg(a),deg(b));

    for (i = 0; i < DEG; i++)
        c.x[i] = (a.x[i] + b.x[i]) % N;

    return c;
}

// 20200816:正規化したいところだがうまく行かない
// 多項式の足し算
vec vsub(vec a, vec b)
{
    vec c = {0};
    // int i, j, k, l = 0;
    vec h = {0}, f2 = {0}, g2 = {0};

    for (int i = 0; i < DEG; i++)
    {
        if (a.x[i] >= b.x[i])
            c.x[i] = (a.x[i] - b.x[i]) % N;
        if (a.x[i] < b.x[i])
            c.x[i] = (N + a.x[i] - b.x[i]) % N;
    }

    return c;
}

vec xor(vec a,vec b){
    int i=0;
    vec c={0};

    for(i=0;i<23;i++)
    c.x[i]=a.x[i]^b.x[i];

    return c;
}

// 多項式を項ずつ掛ける
vec vterml(vec f, oterm t)
{
    // f = conv(f);
    // ssert(op_verify(f));
    int i;
    vec h = {0};

    // f=conv(f);
    // k = deg (o2v(f));

    for (i = 0; i < DEG; i++)
    {
        // h.t[i].n = f.t[i].n + t.n;
        if (f.x[i] > 0)
            h.x[i + t.n] = (f.x[i] * t.a) % N;
    }

    // h = conv(h);
    //  assert(op_verify(h));
    return h;
}

//多項式の商を取る
vec vdiv(vec f, vec g)
{

  int i = 0, j, n, k;
  vec h = {0}, e = {0}, tt = {0};
  oterm a, b = {0}, c = {0};

  if (vLT(f).n == 0 && vLT(g).a == 0)
  {
    printf("baka^\n");
    //return f;
    exit(1);
  }
  if (vLT(g).a == 0)
  {
    exit(1);
  }
  if (vLT(g).n == 0 && vLT(g).a > 1)
    return coeff(f, vLT(g).a);

  k = deg(g);
  b = vLT(g);
  if (b.a == 1 && b.n == 0)
    return f;
  if (b.a == 0 && b.n == 0)
  {
    printf("baka in vdiv\n");
    exit(1);
  }
  if (deg((f)) < deg((g)))
  {
    return f;
    //  a=LT(f);
  }

  i = 0;
  while (vLT(f).n > 0 && vLT(g).n > 0)
  {
    c = vLTdiv(f, b);
    assert(c.n < DEG);
    tt.x[c.n] = c.a;
    //i++;

    h = vterml(g, c);

    f = xor(f, h);
    if (deg((f)) == 0 || deg((g)) == 0)
    {
      //printf ("blake2\n");
      break;
    }

    if (c.n == 0)
      break;
  }

  // tt は逆順に入ってるので入れ替える
  return tt;
}


vec conv(vec a,vec b,int n){
    int i,l=0,j=0;
    vec c={0};

    for(int k=0;k<n;k++){
        l=0;
        for(i=0;i<n;i++){
            for(j=0;j<n;j++){
            if((i+j)==k){
            l+=(a.x[i]*b.x[j]);
            //printf("i=%d,j=%d, %d %d\n",i,j,a.x[i],b.x[j]);
            }
            }
        }
        //printf("\n");
        c.x[k]=l%2;
    }

    return c;
}

vec and(vec a,vec b){
    int i;
    vec c={0};

    for(i=0;i<23;i++)
    c.x[i]=a.x[i]&b.x[i];

    return c;
}

vec or(vec a,vec b){
    int i;
    vec c={0};

    for(i=0;i<23;i++)
    c.x[i]=(a.x[i]|b.x[i]);

return c;
}


int wt(vec a){
    int i=0,k=0;

    for(i=0;i<23;i++){
    if(a.x[i]>0)
    k++;
    }

    return k;
}

unsigned long long sind(unsigned long long a){
int i,j[11]={0};
unsigned long long x=0;
for(i=0;i<11;i++){
    x<<=1;
j[i]=__builtin_popcount(H[i]&a)%2;
x^=j[i];
}
//printf("mm=%b\n",x);

return x;
}

#define SWAP(type, a, b) \
  {                      \
    type work = a;       \
    a = b;               \
    b = work;            \
  }


/*
    Fisher-Yates shuffle による方法
    配列の要素をランダムシャッフルする
*/
void random_shuffle(unsigned short *array, size_t size)
{
  for (size_t i = size; i > 1; --i)
  {
    size_t a = i - 1;
    size_t b = rand() % i;
    SWAP(int, array[a], array[b]);
  }
}


void title(void){
    printf("This is Naoya'n Crypto Demo. ");
    printf("GPL3.0 by Naoya.\n\n");

    return;
}

void look(vec a){
    int i;

    for(i=0;i<23;i++)
    printf("%d,",a.x[i]);
    printf("\n");
}

vec inn(vec a,vec b){
    int i;
    vec c={0};

    for(i=0;i<23;i++)
    c.x[i]=a.x[i]*b.x[i]%2;

    return c;
}


void encode(void){
    int k=12,i,count[10]={0},l=0;
    vec x={0},h={0},r1={0},r2={0},y={0};
    vec a={1,2,3};
    vec b={4,5,6};

    /*
    vec v=conv(a,b,3);
    for(i=0;i<3;i++)
    printf("%d,",v.x[i]);
    printf("\n");
    //exit(1);
    */

    title();

    // about
    x.x[11]=1;
    h.x[5]=1;
    y.x[17]=1;

    vec P={0};
    for(i=0;i<23;i++)
    P.x[i]=i;
    random_shuffle(P.x,23);
    look(P);
    vec inv_P={0};
    for(i=0;i<23;i++)
    inv_P.x[P.x[i]]=i;


    srand(clock());
    vec e={0};
    
    while(1)
    {
    for(i=0;i<23;i++){
    r1.x[i]=0;
    r2.x[i]=0;
    e.x[i]=0;
    }
    

    while(count[1]<1){
        l=rand()%23;
        if(r1.x[l]==0){
        r1.x[l]=1;
        count[1]++;
        }
        printf("a");
    }
    while(count[2]<1){
        l=rand()%23;
        if(r2.x[l]==0){
        r2.x[l]=1;
        count[2]++;
        }
        printf("b");
    }
    while(count[4]<1){
        l=rand()%23;
        if(e.x[l]==0){
        e.x[l]=1;
        count[4]++;
        }
        printf("c");
    }

    printf("\n");
    
    vec never={0};

    vec s=or(x,conv(h,y,23));
    vec u=or(r1,conv(h,r2,23)),vv=or(conv(s,r2,23),e);
    vec t=or(vv,conv(u,y,23));

    int n=wt(t),o=wt(or(conv(h,y,23),r2));

    printf("\nwt(t)=%d wt(r)=%d wt(s)=%d,wt(u)=%d,wt(v)=%d\n",n,o,wt(s),wt(u),wt(vv));
    if(n>0 && n<=3 && wt(u)>0 && wt(vv)>0)
    {
        printf("wr(x)=%d wt(h)=%d wt(r1)=%d,wt(r2)=%d,wt(y)=%d,wt(e)=%d\n",wt(x),wt(h),wt(r1),wt(r2),wt(y),wt(e));

        printf("Pub_key=\n");
        printf("s= ");
        look(s);
        printf("h= ");
        look(h);
        printf("Secret_key=\n");
        printf("x= ");
        look(x);
        printf("y= ");
        look(y);
        printf("chpher (u,v)=\n");
        printf("u= ");
        look(u);
        printf("v= ");
        look(vv);
        printf("r= \n");
        printf("r1=");
        look(r1);
        printf("r2=");
        look(r2);
        printf("e= ");
        look(e);
        printf("v-uy=\n   ");
        look(t);
        printf("you are lucky.\n\n");

        unsigned gol=0b101011100011;
        unsigned plain=0b11111111;
        unsigned mm=0;
        for(i=0;i<23;i++){
            mm<<=1;
            mm^=t.x[i];
            //printf("%d,",vv.x[i]);
        }

        vec tmp=xor(i2v(enc(plain,gol)),vv);
        vec tmp2={0};
        for(i=0;i<23;i++)
        tmp2.x[i]=tmp.x[P.x[i]];
        printf("Oh!=");
        look(tmp2);
        unsigned cipher=v2i(tmp2);
        tmp=i2v(cipher);
        for(i=0;i<23;i++)
        tmp2.x[i]=tmp.x[inv_P.x[i]];
        printf("reverse=\n");
        look(tmp2);
        vec u2=or(tmp2,conv(u,y,23));
        unsigned cipher2=v2i(u2);
        unsigned decode=v2i(vdiv(i2v(cipher2^syndrome[sind(((cipher2)))]),i2v(gol)));
        unsigned w=0b11;
        

        printf("golay= %b\ntext = %b\n",gol,plain);
        printf("cipher=%b\n",cipher);
        printf("err=   %b\n",mm);
        printf("decode=%b\n",decode);
        printf("times= %d\n",count[6]);
        exit(1);
    }
        n=0;
        for(i=0;i<6;i++)
        count[i]=0;
        printf("('A`)\n");
        count[6]++;
    }


    return;
}

void main(void){

    encode();

    return;
}